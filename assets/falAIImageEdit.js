const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index2.js","./index.js"])))=>i.map(i=>d[i]);
import{d as q,r as d,o as H,_ as W,c as i,a as o,b as l,e as w,w as s,f as X,t as r,F as A,g as E,h as b,i as u,j as Y,k}from"./index.js";const Z={class:"fal-ai-image-edit"},$={class:"apikey-section"},ee={key:0,class:"tip"},le={key:1,class:"tip"},ae={key:0,style:{color:"red","margin-top":"16px"}},te={key:1,style:{"margin-top":"16px"}},oe={key:2,style:{"margin-top":"24px"}},se={style:{display:"flex","flex-wrap":"wrap",gap:"16px"}},ue=["src","alt","width","height"],ie={style:{"font-size":"12px",color:"#888"}},ne={key:3,style:{"margin-top":"40px"}},de={style:{"font-size":"13px",color:"#888","margin-bottom":"6px"}},re={style:{"margin-bottom":"6px"}},pe={style:{color:"#333"}},ve={style:{"margin-bottom":"6px"}},me={key:0},fe={style:{display:"flex","flex-wrap":"wrap",gap:"12px"}},_e=["src","alt","width","height"],ye={style:{"font-size":"11px",color:"#aaa"}},ce=q({__name:"falAIImageEdit",setup(N){let m=null;const f=d(""),t=d(null);H(async()=>{const p=localStorage.getItem("fal_apikey");p&&(f.value=p,t.value=p,await I(),t.value&&m.config({credentials:t.value}))});async function I(){m||(m=(await W(async()=>{const{fal:p}=await import("./index2.js").then(e=>e.i);return{fal:p}},__vite__mapDeps([0,1]),import.meta.url)).fal)}function B(){f.value&&(localStorage.setItem("fal_apikey",f.value),t.value=f.value,m&&m.config({credentials:f.value}))}function j(){localStorage.removeItem("fal_apikey"),f.value="",t.value=null}const S=d(""),K=d(""),O=d(null),C=d(3.5),R=d(1),z=d("jpeg"),P=d(""),x=d(!1),_=d([]),y=d(""),U=d([]),D=d([]);function G(p){O.value=p.raw||null}async function T(){if(y.value="",_.value=[],U.value=[],!S.value.trim()){y.value="请输入描述（Prompt）";return}if(x.value=!0,await I(),!m){y.value="fal-ai 客户端加载失败",x.value=!1;return}if(!t.value){y.value="请先输入 API Key",x.value=!1;return}m.config({credentials:t.value});let p=K.value;try{if(O.value&&(_.value.push("正在上传图片..."),p=await m.storage.upload(O.value),_.value.push("图片上传成功")),!p){y.value="请上传图片或填写图片 URL",x.value=!1;return}_.value.push("正在请求 fal.ai 生成图片...");const e={prompt:S.value,image_url:p,guidance_scale:C.value,num_images:R.value,output_format:z.value,...P.value?{aspect_ratio:P.value}:{}},g=await m.subscribe("fal-ai/flux-pro/kontext/max",{input:e,logs:!0,onQueueUpdate:n=>{n.status==="IN_PROGRESS"&&n.logs&&n.logs.map(c=>c.message).forEach(c=>{_.value.includes(c)||_.value.push(c)})}});g.data&&g.data.images?(U.value=g.data.images,_.value.push("图片生成成功"),D.value.unshift({params:JSON.parse(JSON.stringify(e)),images:JSON.parse(JSON.stringify(g.data.images)),time:new Date().toLocaleString()})):y.value="未获取到图片结果"}catch(e){y.value=(e==null?void 0:e.message)||"请求失败"}finally{x.value=!1}}return(p,e)=>{const g=b("el-input"),n=b("el-form-item"),c=b("el-button"),F=b("el-form"),Q=b("el-upload"),J=b("el-input-number"),v=b("el-option"),L=b("el-select");return u(),i("div",Z,[e[17]||(e[17]=o("h2",null,"fal.ai 图像编辑 DEMO",-1)),o("div",$,[l(F,{inline:!0,class:"apikey-form"},{default:s(()=>[l(n,{label:"API Key："},{default:s(()=>[l(g,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),type:"password",placeholder:"请输入 fal.ai API Key",style:{width:"260px"}},null,8,["modelValue"])]),_:1}),l(n,null,{default:s(()=>[l(c,{type:"primary",onClick:B},{default:s(()=>e[7]||(e[7]=[k("保存")])),_:1}),t.value?(u(),Y(c,{key:0,onClick:j,type:"default"},{default:s(()=>e[8]||(e[8]=[k("清除")])),_:1})):w("",!0)]),_:1})]),_:1}),t.value?(u(),i("div",le,e[10]||(e[10]=[o("span",{style:{color:"green"}},"API Key 已保存，可正常使用 fal.ai 能力。",-1)]))):(u(),i("div",ee,e[9]||(e[9]=[o("span",{style:{color:"red"}},"请先输入 API Key，所有功能仅用于 DEMO，切勿用于生产环境！",-1)])))]),l(F,{class:"falai-form",onSubmit:X(T,["prevent"]),"label-width":"140px"},{default:s(()=>[l(n,{label:"描述（Prompt）："},{default:s(()=>[l(g,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),type:"textarea",autosize:{minRows:4,maxRows:8},disabled:!t.value,placeholder:"请输入描述，如：在面粉旁边放一个甜甜圈。",style:{width:"100%","font-size":"16px"}},null,8,["modelValue","disabled"])]),_:1}),l(n,{label:"图片："},{default:s(()=>[l(Q,{"show-file-list":!0,disabled:!t.value,accept:"image/*",action:"#","auto-upload":!1,"on-change":G,limit:1},{default:s(()=>[l(c,{disabled:!t.value},{default:s(()=>e[11]||(e[11]=[k("选择图片")])),_:1},8,["disabled"])]),_:1},8,["disabled"]),e[12]||(e[12]=o("span",{style:{margin:"0 8px"}},"或",-1)),l(g,{modelValue:K.value,"onUpdate:modelValue":e[2]||(e[2]=a=>K.value=a),disabled:!t.value,placeholder:"图片 URL（可选）",style:{width:"260px"}},null,8,["modelValue","disabled"])]),_:1}),l(n,{label:"引导强度（guidance_scale）："},{default:s(()=>[l(J,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=a=>C.value=a),min:1,max:20,step:.1,disabled:!t.value},null,8,["modelValue","disabled"])]),_:1}),l(n,{label:"生成图片数量（num_images）："},{default:s(()=>[l(J,{modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=a=>R.value=a),min:1,max:4,disabled:!t.value},null,8,["modelValue","disabled"])]),_:1}),l(n,{label:"输出格式（output_format）："},{default:s(()=>[l(L,{modelValue:z.value,"onUpdate:modelValue":e[5]||(e[5]=a=>z.value=a),disabled:!t.value,style:{width:"120px"}},{default:s(()=>[l(v,{label:"JPEG 格式",value:"jpeg"}),l(v,{label:"PNG 格式",value:"png"})]),_:1},8,["modelValue","disabled"])]),_:1}),l(n,{label:"宽高比（aspect_ratio）："},{default:s(()=>[l(L,{modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=a=>P.value=a),disabled:!t.value,style:{width:"120px"}},{default:s(()=>[l(v,{label:"默认",value:""}),l(v,{label:"21:9",value:"21:9"}),l(v,{label:"16:9",value:"16:9"}),l(v,{label:"4:3",value:"4:3"}),l(v,{label:"3:2",value:"3:2"}),l(v,{label:"1:1",value:"1:1"}),l(v,{label:"2:3",value:"2:3"}),l(v,{label:"3:4",value:"3:4"}),l(v,{label:"9:16",value:"9:16"}),l(v,{label:"9:21",value:"9:21"})]),_:1},8,["modelValue","disabled"])]),_:1}),l(n,null,{default:s(()=>[l(c,{type:"primary","native-type":"submit",disabled:!t.value||x.value},{default:s(()=>[k(r(x.value?"生成中...":"生成图片"),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),y.value?(u(),i("div",ae,r(y.value),1)):w("",!0),_.value.length?(u(),i("div",te,[e[13]||(e[13]=o("div",{style:{"font-weight":"bold"}},"日志：",-1)),o("ul",null,[(u(!0),i(A,null,E(_.value,(a,h)=>(u(),i("li",{key:h},r(a),1))),128))])])):w("",!0),U.value.length?(u(),i("div",oe,[e[14]||(e[14]=o("div",{style:{"font-weight":"bold"}},"生成结果：",-1)),o("div",se,[(u(!0),i(A,null,E(U.value,(a,h)=>(u(),i("div",{key:h,style:{border:"1px solid #eee",padding:"8px","border-radius":"6px",background:"#fff"}},[o("img",{src:a.url,alt:"result-"+h,width:a.width/4,height:a.height/4,style:{"max-width":"200px",display:"block","margin-bottom":"8px"}},null,8,ue),o("div",ie,r(a.width)+"x"+r(a.height),1)]))),128))])])):w("",!0),D.value.length?(u(),i("div",ne,[e[16]||(e[16]=o("div",{style:{"font-weight":"bold","font-size":"16px"}},"历史记录",-1)),(u(!0),i(A,null,E(D.value,(a,h)=>(u(),i("div",{key:h,style:{"margin-top":"18px",padding:"12px",border:"1px solid #eee","border-radius":"6px",background:"#f8f8fa"}},[o("div",de,r(a.time),1),o("div",re,[e[15]||(e[15]=k("Prompt: ")),o("span",pe,r(a.params.prompt),1)]),o("div",ve,[k("引导强度: "+r(a.params.guidance_scale)+" | 数量: "+r(a.params.num_images)+" | 输出格式: "+r(a.params.output_format)+" ",1),a.params.aspect_ratio?(u(),i("span",me,"| 宽高比: "+r(a.params.aspect_ratio),1)):w("",!0)]),o("div",fe,[(u(!0),i(A,null,E(a.images,(V,M)=>(u(),i("div",{key:M,style:{border:"1px solid #eee",padding:"4px","border-radius":"4px",background:"#fff"}},[o("img",{src:V.url,alt:"history-"+h+"-"+M,width:V.width/8,height:V.height/8,style:{"max-width":"100px",display:"block"}},null,8,_e),o("div",ye,r(V.width)+"x"+r(V.height),1)]))),128))])]))),128))])):w("",!0)])}}}),ge=(N,m)=>{const f=N.__vccOpts||N;for(const[t,I]of m)f[t]=I;return f},xe=ge(ce,[["__scopeId","data-v-fb1af761"]]);export{xe as default};
